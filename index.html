<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>è‡ªç”±å¬ä¹¦ Â· AI Voice</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text y='32' font-size='32'>ğŸ“–</text></svg>">
<style>
body {margin:0;font-family:'Inter',sans-serif;background:linear-gradient(135deg,#e0e4f2,#f5f5fa);color:#333;display:flex;justify-content:center;align-items:center;min-height:100vh;}
.container {background:#fff;padding:40px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.1);max-width:720px;width:90%;text-align:center;}
h1{font-size:2.2rem;margin-bottom:10px;color:#1f1f3a;}
.sub{font-size:1rem;color:#555;margin-bottom:20px;}
.language{margin-bottom:20px;text-align:left;}
.language label{margin-right:10px;font-weight:600;}
.language select{padding:8px 12px;border-radius:10px;border:1px solid #ccc;background:#2c2c4a;color:#f5f5f5;font-weight:500;cursor:pointer;}
.controls{display:flex;flex-wrap:wrap;justify-content:flex-start;gap:10px;margin-top:20px;}
button, select#rate, select#voice{background:#2c2c4a;color:#f5f5f5;border:none;padding:10px 14px;font-size:0.95rem;border-radius:12px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 4px 10px rgba(0,0,0,0.1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:80px;}
#pauseBtn, #stopBtn{min-width:60px;border-radius:4px;}
#stopBtn{border-radius:25%;}
button:hover, select#rate:hover, select#voice:hover{background:#3a3a6a;transform:translateY(-2px);}
select#rate, select#voice{min-width:100px;}
textarea{width:100%;height:200px;background:#f9f9fd;color:#333;border:none;border-radius:15px;padding:16px;font-size:16px;resize:vertical;box-shadow:inset 0 2px 4px rgba(0,0,0,0.05);}
#textContainer span.read{color:#aaa;cursor:default;}
#textContainer span{cursor:pointer;}
@media(max-width:500px){.controls{flex-direction:column;}button,select#rate,select#voice{width:100%;}}
</style>
</head>
<body>
<div class="container">
  <h1 id="title">ğŸ“– è‡ªç”±å¬ä¹¦</h1>
  <p class="sub" id="subtitle">ç²˜è´´ä»»ä½•æ–‡å­— Â· å…è´¹æœ—è¯» Â· æ— é™æ–‡ç« </p>
  <div class="language">
    <label id="langLabel">è¯­è¨€:</label>
    <select id="langSelect"></select>
  </div>
  <div class="controls">
    <button id="editBtn">âœï¸ ç¼–è¾‘æ–‡ç« </button>
    <button id="playBtn">â–¶ æ’­æ”¾</button>
    <button id="pauseBtn">â¸ æš‚åœ</button>
    <button id="resumeBtn">â–¶ ç»§ç»­</button>
    <button id="stopBtn">â¹ åœæ­¢</button>
    <button id="resetBtn">ğŸ”„ é‡ç½®</button>
  </div>
  <div id="editContainer">
    <textarea id="text" placeholder="åœ¨è¿™é‡Œç²˜è´´ä»»ä½•ä½ æƒ³å¬çš„æ–‡å­—â€¦"></textarea>
  </div>
  <div id="readContainer" style="display:none;">
    <div id="textContainer"></div>
  </div>
  <div class="controls">
    <select id="rate">
      <option value="0.8">0.8x</option>
      <option value="1" selected>1x</option>
      <option value="1.2">1.2x</option>
      <option value="1.5">1.5x</option>
    </select>
    <select id="voice"></select>
  </div>
</div>

<script>
let voices=[], utterance=null, isPaused=false;
let originalSentences=[], activeQueue=[], hiddenIndexSet=new Set();
let currentLang='zh-CN';

const LANG_ORDER = ["zh-CN","zh-TW","ms-MY","ar","en","hi","ko","ja","th","es","fr","de","it","pt","ru","nl","vi"];

const i18n = {
  "zh-CN": { name:"ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰", title:"ğŸ“– è‡ªç”±å¬ä¹¦", subtitle:"ç²˜è´´ä»»ä½•æ–‡å­— Â· å…è´¹æœ—è¯» Â· æ— é™æ–‡ç« ", placeholder:"åœ¨è¿™é‡Œç²˜è´´ä»»ä½•ä½ æƒ³å¬çš„æ–‡å­—â€¦", play:"â–¶ æ’­æ”¾", pause:"â¸ æš‚åœ", stop:"â¹ åœæ­¢", resume:"â–¶ ç»§ç»­", edit:"âœï¸ ç¼–è¾‘æ–‡ç« ", reset:"ğŸ”„ é‡ç½®", languageLabel:"è¯­è¨€:" },
  "zh-TW": { name:"ä¸­æ–‡ï¼ˆç¹é«”ï¼‰", title:"ğŸ“– è‡ªç”±è½æ›¸", subtitle:"è²¼ä¸Šä»»ä½•æ–‡å­— Â· å…è²»æœ—è®€ Â· ç„¡é™æ–‡ç« ", placeholder:"åœ¨é€™è£¡è²¼ä¸Šä½ æƒ³è½çš„æ–‡å­—â€¦", play:"â–¶ æ’­æ”¾", pause:"â¸ æš«åœ", stop:"â¹ åœæ­¢", resume:"â–¶ ç¹¼çºŒ", edit:"âœï¸ ç·¨è¼¯æ–‡ç« ", reset:"ğŸ”„ é‡ç½®", languageLabel:"èªè¨€:" },
  "ms-MY": { name:"Bahasa Melayu", title:"ğŸ“– Bacaan Bebas", subtitle:"Tampal teks Â· Bacaan percuma Â· Tanpa had", placeholder:"Tampal teks di siniâ€¦", play:"â–¶ Main", pause:"â¸ Jeda", stop:"â¹ Henti", resume:"â–¶ Sambung", edit:"âœï¸ Sunting", reset:"ğŸ”„ Tetap semula", languageLabel:"Bahasa:" },
  "ar": { name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", title:"ğŸ“– Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ø­Ø±", subtitle:"Ø§Ù„ØµÙ‚ Ø£ÙŠ Ù†Øµ Â· Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Â· Ø¨Ù„Ø§ Ø­Ø¯ÙˆØ¯", placeholder:"Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§â€¦", play:"â–¶ ØªØ´ØºÙŠÙ„", pause:"â¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª", stop:"â¹ Ø¥ÙŠÙ‚Ø§Ù", resume:"â–¶ Ù…ØªØ§Ø¨Ø¹Ø©", edit:"âœï¸ ØªØ­Ø±ÙŠØ±", reset:"ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†", languageLabel:"Ø§Ù„Ù„ØºØ©:" },
  "en": { name:"English", title:"ğŸ“– Free Listening", subtitle:"Paste any text Â· Free reading Â· Unlimited", placeholder:"Paste any text you want to listen toâ€¦", play:"â–¶ Play", pause:"â¸ Pause", stop:"â¹ Stop", resume:"â–¶ Resume", edit:"âœï¸ Edit Text", reset:"ğŸ”„ Reset", languageLabel:"Language:" },
  "hi": { name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€", title:"ğŸ“– à¤®à¥à¤•à¥à¤¤ à¤¶à¥à¤°à¤µà¤£", subtitle:"à¤•à¥‹à¤ˆ à¤­à¥€ à¤ªà¤¾à¤  à¤šà¤¿à¤ªà¤•à¤¾à¤à¤ Â· à¤¨à¤¿à¤ƒà¤¶à¥à¤²à¥à¤• Â· à¤…à¤¸à¥€à¤®à¤¿à¤¤", placeholder:"à¤¯à¤¹à¤¾à¤ à¤ªà¤¾à¤  à¤šà¤¿à¤ªà¤•à¤¾à¤à¤â€¦", play:"â–¶ à¤šà¤²à¤¾à¤à¤", pause:"â¸ à¤µà¤¿à¤°à¤¾à¤®", stop:"â¹ à¤°à¥‹à¤•à¥‡à¤‚", resume:"â–¶ à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚", edit:"âœï¸ à¤¸à¤‚à¤ªà¤¾à¤¦à¤¿à¤¤ à¤•à¤°à¥‡à¤‚", reset:"ğŸ”„ à¤°à¥€à¤¸à¥‡à¤Ÿ", languageLabel:"à¤­à¤¾à¤·à¤¾:" },
  "ko": { name:"í•œêµ­ì–´", title:"ğŸ“– ììœ  ë‚­ë…", subtitle:"í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸° Â· ë¬´ë£Œ Â· ë¬´ì œí•œ", placeholder:"ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”â€¦", play:"â–¶ ì¬ìƒ", pause:"â¸ ì¼ì‹œì •ì§€", stop:"â¹ ì •ì§€", resume:"â–¶ ê³„ì†", edit:"âœï¸ í¸ì§‘", reset:"ğŸ”„ ì´ˆê¸°í™”", languageLabel:"ì–¸ì–´:" },
  "ja": { name:"æ—¥æœ¬èª", title:"ğŸ“– è‡ªç”±æœ—èª­", subtitle:"ãƒ†ã‚­ã‚¹ãƒˆè²¼ã‚Šä»˜ã‘ Â· ç„¡æ–™ Â· ç„¡åˆ¶é™", placeholder:"ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„â€¦", play:"â–¶ å†ç”Ÿ", pause:"â¸ ä¸€æ™‚åœæ­¢", stop:"â¹ åœæ­¢", resume:"â–¶ ç¶šã‘ã‚‹", edit:"âœï¸ ç·¨é›†", reset:"ğŸ”„ ãƒªã‚»ãƒƒãƒˆ", languageLabel:"è¨€èª:" },
  "th": { name:"à¸ à¸²à¸©à¸²à¹„à¸—à¸¢", title:"ğŸ“– à¸à¸²à¸£à¸­à¹ˆà¸²à¸™à¸­à¸´à¸ªà¸£à¸°", subtitle:"à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ Â· à¸Ÿà¸£à¸µ Â· à¹„à¸¡à¹ˆà¸ˆà¸³à¸à¸±à¸”", placeholder:"à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸™à¸µà¹ˆâ€¦", play:"â–¶ à¹€à¸¥à¹ˆà¸™", pause:"â¸ à¸«à¸¢à¸¸à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§", stop:"â¹ à¸«à¸¢à¸¸à¸”", resume:"â–¶ à¸•à¹ˆà¸­", edit:"âœï¸ à¹à¸à¹‰à¹„à¸‚", reset:"ğŸ”„ à¸£à¸µà¹€à¸‹à¹‡à¸•", languageLabel:"à¸ à¸²à¸©à¸²:" },
  "es": { name:"EspaÃ±ol", title:"ğŸ“– Lectura Libre", subtitle:"Pega texto Â· Gratis Â· Ilimitado", placeholder:"Pega texto aquÃ­â€¦", play:"â–¶ Reproducir", pause:"â¸ Pausa", stop:"â¹ Detener", resume:"â–¶ Continuar", edit:"âœï¸ Editar", reset:"ğŸ”„ Reiniciar", languageLabel:"Idioma:" },
  "fr": { name:"FranÃ§ais", title:"ğŸ“– Lecture Libre", subtitle:"Collez du texte Â· Gratuit Â· IllimitÃ©", placeholder:"Collez le texte iciâ€¦", play:"â–¶ Lire", pause:"â¸ Pause", stop:"â¹ ArrÃªter", resume:"â–¶ Continuer", edit:"âœï¸ Ã‰diter", reset:"ğŸ”„ RÃ©initialiser", languageLabel:"Langue:" },
  "de": { name:"Deutsch", title:"ğŸ“– Freies Lesen", subtitle:"Text einfÃ¼gen Â· Kostenlos Â· Unbegrenzt", placeholder:"Text hier einfÃ¼genâ€¦", play:"â–¶ Abspielen", pause:"â¸ Pause", stop:"â¹ Stop", resume:"â–¶ Fortsetzen", edit:"âœï¸ Bearbeiten", reset:"ğŸ”„ ZurÃ¼cksetzen", languageLabel:"Sprache:" },
  "it": { name:"Italiano", title:"ğŸ“– Lettura Libera", subtitle:"Incolla testo Â· Gratis Â· Illimitato", placeholder:"Incolla testo quiâ€¦", play:"â–¶ Riproduci", pause:"â¸ Pausa", stop:"â¹ Stop", resume:"â–¶ Continua", edit:"âœï¸ Modifica", reset:"ğŸ”„ Reimposta", languageLabel:"Lingua:" },
  "pt": { name:"PortuguÃªs", title:"ğŸ“– Leitura Livre", subtitle:"Cole texto Â· GrÃ¡tis Â· Ilimitado", placeholder:"Cole texto aquiâ€¦", play:"â–¶ Reproduzir", pause:"â¸ Pausar", stop:"â¹ Parar", resume:"â–¶ Continuar", edit:"âœï¸ Editar", reset:"ğŸ”„ Redefinir", languageLabel:"Idioma:" },
  "ru": { name:"Ğ ÑƒÑÑĞºĞ¸Ğ¹", title:"ğŸ“– Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğµ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ", subtitle:"Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Â· Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Â· Ğ‘ĞµĞ· Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹", placeholder:"Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ´ĞµÑÑŒâ€¦", play:"â–¶ Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸", pause:"â¸ ĞŸĞ°ÑƒĞ·Ğ°", stop:"â¹ Ğ¡Ñ‚Ğ¾Ğ¿", resume:"â–¶ ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ", edit:"âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", reset:"ğŸ”„ Ğ¡Ğ±Ñ€Ğ¾Ñ", languageLabel:"Ğ¯Ğ·Ñ‹Ğº:" },
  "nl": { name:"Nederlands", title:"ğŸ“– Vrij Lezen", subtitle:"Plak tekst Â· Gratis Â· Onbeperkt", placeholder:"Plak tekst hierâ€¦", play:"â–¶ Afspelen", pause:"â¸ Pauze", stop:"â¹ Stop", resume:"â–¶ Hervatten", edit:"âœï¸ Bewerken", reset:"ğŸ”„ Reset", languageLabel:"Taal:" },
  "vi": { name:"Tiáº¿ng Viá»‡t", title:"ğŸ“– Nghe Tá»± Do", subtitle:"DÃ¡n vÄƒn báº£n Â· Miá»…n phÃ­ Â· KhÃ´ng giá»›i háº¡n", placeholder:"DÃ¡n vÄƒn báº£n táº¡i Ä‘Ã¢yâ€¦", play:"â–¶ PhÃ¡t", pause:"â¸ Táº¡m dá»«ng", stop:"â¹ Dá»«ng", resume:"â–¶ Tiáº¿p tá»¥c", edit:"âœï¸ Chá»‰nh sá»­a", reset:"ğŸ”„ Äáº·t láº¡i", languageLabel:"NgÃ´n ngá»¯:" }
};

/* ========= æ£€æµ‹æµè§ˆå™¨è¯­è¨€ ========= */
function detectBrowserLangOnce(){
  if(localStorage.getItem('uiLangLocked')) return;
  const nav=navigator.language;
  const match=LANG_ORDER.find(k=>nav===k||nav.startsWith(k.split('-')[0]));
  currentLang=match||'zh-CN';
  localStorage.setItem('uiLangLocked','1');
}

/* ========= åˆå§‹åŒ–è¯­è¨€ä¸‹æ‹‰ ========= */
function initLangSelect(){
  const langSelect=document.getElementById('langSelect');
  langSelect.innerHTML="";
  LANG_ORDER.forEach(k=>{
    const o=document.createElement("option");
    o.value=k;
    o.textContent=i18n[k].name;
    if(k===currentLang) o.selected=true;
    langSelect.appendChild(o);
  });
  langSelect.onchange=()=>{
    currentLang=langSelect.value;
    localStorage.setItem('userLang',currentLang);
    updateLanguage();
  };
}

/* ========= åˆå§‹åŒ– UI ========= */
function initUI(){
  detectBrowserLangOnce();
  const saved = localStorage.getItem('userLang');
  if(saved && i18n[saved]) currentLang = saved;
  initLangSelect();

  // âœ… ç¼–è¾‘æ–‡ç« æŒ‰é’®ä¿®æ”¹ï¼šå…ˆåœæ­¢æœ—è¯»ï¼Œå†æ˜¾ç¤ºç¼–è¾‘åŒº
  document.getElementById('editBtn').onclick = () => {
      hardStop(); // åœæ­¢æœ—è¯»
      setTimeout(()=>{
          editContainer.style.display='block';
          readContainer.style.display='none';
      },50);
  };

  document.getElementById('playBtn').onclick=play;
  document.getElementById('pauseBtn').onclick=hardStop;
  document.getElementById('stopBtn').onclick=softPause;
  document.getElementById('resumeBtn').onclick=resume;
  document.getElementById('resetBtn').onclick=resetQueue;
  const rateSel=document.getElementById('rate');
  rateSel.value=localStorage.getItem('ttsRate')||'1';
  rateSel.onchange=()=>localStorage.setItem('ttsRate',rateSel.value);
  updateLanguage();
}

/* ========= æ›´æ–°è¯­è¨€æ–‡æœ¬ ========= */
function updateLanguage(){
  const t=i18n[currentLang];
  document.getElementById('title').textContent=t.title;
  document.getElementById('subtitle').textContent=t.subtitle;
  document.getElementById('text').placeholder=t.placeholder;
  document.getElementById('playBtn').textContent=t.play;
  document.getElementById('pauseBtn').textContent=t.pause;
  document.getElementById('stopBtn').textContent=t.stop;
  document.getElementById('resumeBtn').textContent=t.resume;
  document.getElementById('editBtn').textContent=t.edit;
  document.getElementById('resetBtn').textContent=t.reset;
  document.querySelector(".language label").textContent=t.languageLabel;
}

/* ========= TTS ========= */
function loadVoices(){
  voices=speechSynthesis.getVoices();
  const vSel=document.getElementById('voice');
  vSel.innerHTML="";
  voices.forEach((v,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=v.name+" ("+v.lang+")";
    vSel.appendChild(o);
  });
  const sv=localStorage.getItem('ttsVoice'); if(sv) vSel.value=sv;
  vSel.onchange=()=>localStorage.setItem('ttsVoice',vSel.value);
}

/* ========= æ’­æ”¾é€»è¾‘ ========= */
function splitTextIntoSentences(text){
  return text.match(/[^ã€‚ï¼ï¼Ÿ,.!?ï¼›;:\r\n]+[ã€‚ï¼ï¼Ÿ,.!?ï¼›;:]?/g)?.map(s=>s.trim()).filter(Boolean)||[];
}

function isOnlyPunctuation(str){ return /^[\s\p{P}]+$/u.test(str); }

function initQueue(){
  const raw=splitTextIntoSentences(text.value);
  originalSentences=raw.map((t,i)=>({text:t,index:i}));
  activeQueue=[...originalSentences];
  hiddenIndexSet.clear();
  // å…ˆæŠŠåªæœ‰æ ‡ç‚¹çš„å¥åŠ å…¥éšè—åŒº
  originalSentences.forEach(item=>{ if(isOnlyPunctuation(item.text)) hiddenIndexSet.add(item.index); });
  activeQueue=activeQueue.filter(item=>!hiddenIndexSet.has(item.index));
  renderSentences();
  editContainer.style.display='none';
  readContainer.style.display='block';
}

function renderSentences(){
  textContainer.innerHTML="";
  originalSentences.forEach(item=>{
    const span=document.createElement("span");
    span.textContent=item.text+" ";
    if(hiddenIndexSet.has(item.index)) span.classList.add("read");
    span.onclick=()=>jumpToSentence(item.index);
    textContainer.appendChild(span);
  });
}

function play(){
  hardStop();
  initQueue();
  isPaused=false;
  playNext();
}

function playNext(){
  if(!activeQueue.length) return;
  const item=activeQueue[0];
  utterance=new SpeechSynthesisUtterance(item.text);
  utterance.voice=voices[voice.value]||voices[0];
  utterance.rate=parseFloat(rate.value);
  utterance.onend=()=>{
    hiddenIndexSet.add(item.index);
    activeQueue.shift();
    renderSentences();
    if(activeQueue.length && !isPaused) playNext();
  };
  speechSynthesis.speak(utterance);
}

function jumpToSentence(idx){
  hardStop();
  hiddenIndexSet.clear();
  originalSentences.forEach(item=>{ if(item.index<idx) hiddenIndexSet.add(item.index); });
  activeQueue=originalSentences.filter(item=>item.index>=idx && !isOnlyPunctuation(item.text));
  renderSentences();
  playNext();
}

function softPause(){
  if(speechSynthesis.speaking && !speechSynthesis.paused){
    isPaused=true;
    speechSynthesis.pause();
  }
}

function hardStop(){
  isPaused=false;
  speechSynthesis.cancel();
}

function resume(){
  if(speechSynthesis.paused){
    isPaused=false;
    speechSynthesis.resume();
  }else if(activeQueue.length){
    playNext();
  }
}

function resetQueue(){
  hardStop();
  originalSentences=[];
  activeQueue=[];
  hiddenIndexSet.clear();
  text.value="";
  textContainer.innerHTML="";
  editContainer.style.display='block';
  readContainer.style.display='none';
}

/* ========= å¯åŠ¨ ========= */
document.addEventListener("DOMContentLoaded",()=>{
  initUI();
  loadVoices();
  setTimeout(loadVoices,500);
});
speechSynthesis.onvoiceschanged=loadVoices;
</script>
</body>
</html>
